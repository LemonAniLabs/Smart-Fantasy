# é–‹å§‹è³‡æ–™æ”¶é›† - å®Œæ•´æµç¨‹

## æ¦‚è¿°

æœ¬æ–‡æª”å°‡å¼•å°ä½ å®Œæˆåˆå§‹è³‡æ–™æ”¶é›†çš„å®Œæ•´æµç¨‹ã€‚

**é‡è¦æç¤º**:
- é€™æ˜¯**ä¸€æ¬¡æ€§çš„å¤§é‡è³‡æ–™å»ºåˆ¶**
- ä½¿ç”¨ Python å·¥å…·é€²è¡Œåˆå§‹åŒ–
- å®Œæˆå¾Œï¼Œæœªä¾†çš„åŒæ­¥æœƒä½¿ç”¨ Next.js API + Cron Jobs

---

## å‰ç½®æº–å‚™ç¢ºèª

å·²å®Œæˆçš„æº–å‚™å·¥ä½œï¼š

- âœ… Python è™›æ“¬ç’°å¢ƒå·²å»ºç«‹
- âœ… æ‰€æœ‰ Python ä¾è³´å·²å®‰è£
- âœ… Yahoo OAuth æ†‘è­‰å·²é…ç½® (`~/.yfpy/private.json`)
- âœ… Supabase æ†‘è­‰å·²è¨­å®š (`.env`)
- âœ… Next.js dev server æ­£åœ¨é‹è¡Œ (`http://localhost:3000`)

---

## æ­¥é©Ÿ 1: å–å¾—ä½ çš„è¯ç›Ÿ ID

### 1.1 ç™»å…¥ Web æ‡‰ç”¨

åœ¨ç€è¦½å™¨ä¸­æ‰“é–‹ï¼š

```
http://localhost:3000
```

é»æ“Šã€ŒSign in with Yahooã€ä¸¦å®Œæˆç™»å…¥ã€‚

### 1.2 å‘¼å« Leagues API

ç™»å…¥å¾Œï¼Œåœ¨ç€è¦½å™¨çš„é–‹ç™¼è€…å·¥å…· Console ä¸­åŸ·è¡Œï¼š

```javascript
fetch('/api/yahoo/leagues')
  .then(r => r.json())
  .then(data => {
    console.log('=== ä½ çš„ Fantasy è¯ç›Ÿ ===');
    console.log(data);

    if (data.leagues && data.leagues.length > 0) {
      data.leagues.forEach((league, i) => {
        console.log(`\n[${i + 1}] ${league.name}`);
        console.log(`    League ID: ${league.league_id}`);
        console.log(`    League Key: ${league.league_key}`);
        console.log(`    Season: ${league.season}`);
        console.log(`    Teams: ${league.num_teams}`);
      });

      // è¨˜ä¸‹ç¬¬ä¸€å€‹è¯ç›Ÿçš„ ID
      const leagueId = data.leagues[0].league_id;
      console.log(`\nğŸ“‹ ä½¿ç”¨æ­¤ League ID: ${leagueId}`);
      console.log(`\nä¸‹ä¸€æ­¥åŸ·è¡Œ:\ncd scripts && venv/bin/python backfill_data.py ${leagueId} 2024-25 5`);
    }
  });
```

**è¼¸å‡ºç¯„ä¾‹**:
```
=== ä½ çš„ Fantasy è¯ç›Ÿ ===
{
  success: true,
  leagues: [
    {
      league_id: "12345",
      league_key: "nba.l.12345",
      name: "My Fantasy League 2025-26",
      season: 2025,
      num_teams: 12
    }
  ],
  count: 1
}

[1] My Fantasy League 2025-26
    League ID: 12345
    League Key: nba.l.12345
    Season: 2025
    Teams: 12

ğŸ“‹ ä½¿ç”¨æ­¤ League ID: 12345
```

**è¨˜ä¸‹ä½ çš„ `league_id`**ï¼ˆä¾‹å¦‚: `12345`ï¼‰

---

## æ­¥é©Ÿ 2: æ¸¬è©¦å–®ä¸€çƒå“¡ (å»ºè­°)

åœ¨é–‹å§‹å¤§é‡æ”¶é›†ä¹‹å‰ï¼Œå»ºè­°å…ˆæ¸¬è©¦å–®ä¸€çƒå“¡ç¢ºä¿ä¸€åˆ‡æ­£å¸¸ã€‚

### 2.1 é€²å…¥ scripts ç›®éŒ„

```bash
cd /home/acer/Repo/Fantasy/fantasy-basketball-ai/scripts
```

### 2.2 æ¸¬è©¦æ”¶é›† 5 å€‹çƒå“¡çš„ 2024-25 è³½å­£è³‡æ–™

```bash
venv/bin/python backfill_data.py <ä½ çš„_league_id> 2024-25 5
```

**ç¯„ä¾‹**:
```bash
venv/bin/python backfill_data.py 12345 2024-25 5
```

### 2.3 é æœŸè¼¸å‡º

```
============================================================
ğŸ€ Yahoo Fantasy Basketball è³‡æ–™å›å¡«å·¥å…·
============================================================

âœ“ åˆå§‹åŒ–å®Œæˆ: nba.l.12345 (2025)
ğŸ“‹ æ­£åœ¨ç²å–è¯ç›Ÿçƒå“¡åˆ—è¡¨...
âœ“ æ‰¾åˆ° 200 å€‹çƒå“¡
â„¹ï¸  é™åˆ¶è™•ç†å‰ 5 å€‹çƒå“¡

============================================================
ğŸ€ é–‹å§‹å›å¡« 2024-25 è³½å­£
ğŸ“… æ—¥æœŸç¯„åœ: 2024-10-22 è‡³ 2025-06-17
============================================================

[1/5] LeBron James (nba.p.3704)
------------------------------------------------------------
  å·²å­˜åœ¨: 0 å ´
  æ–°å¢: 45 å ´
  API èª¿ç”¨: 245 æ¬¡

[2/5] Stephen Curry (nba.p.4612)
------------------------------------------------------------
  å·²å­˜åœ¨: 0 å ´
  æ–°å¢: 50 å ´
  API èª¿ç”¨: 245 æ¬¡

...

============================================================
âœ… å›å¡«å®Œæˆï¼
============================================================
è™•ç†çƒå“¡: 5/5
æ–°å¢æ¯”è³½: 225 å ´
API èª¿ç”¨: 1225 æ¬¡
éŒ¯èª¤: 0 å€‹
============================================================
```

### 2.4 é©—è­‰è³‡æ–™

åœ¨ Supabase Dashboard åŸ·è¡Œï¼š

```sql
SELECT
  player_name,
  COUNT(*) as games_count,
  MIN(game_date) as first_game,
  MAX(game_date) as last_game
FROM player_game_logs
GROUP BY player_key, player_name
ORDER BY games_count DESC;
```

æ‡‰è©²çœ‹åˆ° 5 å€‹çƒå“¡åŠå…¶æ¯”è³½è¨˜éŒ„ã€‚

---

## æ­¥é©Ÿ 3: å®Œæ•´è³‡æ–™æ”¶é›†

æ¸¬è©¦æˆåŠŸå¾Œï¼Œé–‹å§‹å®Œæ•´çš„è³‡æ–™æ”¶é›†ã€‚

### 3.1 æ”¶é›†ç­–ç•¥

**å»ºè­°é †åº**ï¼š
1. **å…ˆå»ºç«‹ 2024-25 è³½å­£è³‡æ–™**ï¼ˆå·²çµæŸçš„è³½å­£ï¼Œè³‡æ–™å®Œæ•´ï¼‰
2. **å†æ”¶é›† 2025-26 è³½å­£è³‡æ–™**ï¼ˆç•¶å‰è³½å­£ï¼ŒæŒçºŒæ›´æ–°ï¼‰

### 3.2 å›å¡« 2024-25 è³½å­£ï¼ˆæ‰€æœ‰çƒå“¡ï¼‰

```bash
venv/bin/python backfill_data.py <ä½ çš„_league_id> 2024-25
```

**æ³¨æ„**:
- é€™æœƒè™•ç†æ•´å€‹è¯ç›Ÿçš„æ‰€æœ‰çƒå“¡ï¼ˆç´„ 200 å€‹ï¼‰
- **é ä¼°æ™‚é–“: ç´„ 3-4 å°æ™‚**
- æ”¯æ´æ–·é»çºŒå‚³ï¼ˆå¯éš¨æ™‚ä¸­æ–·ä¸¦é‡æ–°åŸ·è¡Œï¼‰
- æœƒè‡ªå‹•è·³éå·²å­˜åœ¨çš„è³‡æ–™

### 3.3 æ”¶é›† 2025-26 è³½å­£ï¼ˆç•¶å‰è³½å­£ï¼‰

2024-25 è³½å­£å®Œæˆå¾Œï¼ŒåŸ·è¡Œï¼š

```bash
venv/bin/python backfill_data.py <ä½ çš„_league_id> 2025-26
```

**æ³¨æ„**:
- ç•¶å‰è³½å­£æ¯”è³½è¼ƒå°‘ï¼Œæ™‚é–“æœƒè¼ƒçŸ­
- **é ä¼°æ™‚é–“: ç´„ 1-2 å°æ™‚**

---

## æ­¥é©Ÿ 4: ç›£æ§èˆ‡é©—è­‰

### 4.1 ç›£æ§é€²åº¦

è…³æœ¬æœƒå³æ™‚é¡¯ç¤ºé€²åº¦ï¼š
- ç•¶å‰è™•ç†çš„çƒå“¡ (ä¾‹å¦‚: `[15/200]`)
- æ¯å€‹çƒå“¡æ‰¾åˆ°çš„æ¯”è³½æ•¸
- API èª¿ç”¨æ¬¡æ•¸
- éŒ¯èª¤æ•¸é‡

### 4.2 ä¸­æ–·èˆ‡çºŒå‚³

å¦‚æœéœ€è¦ä¸­æ–·ï¼š
- æŒ‰ `Ctrl+C` å³å¯å®‰å…¨ä¸­æ–·
- é‡æ–°åŸ·è¡Œç›¸åŒæŒ‡ä»¤å³å¯ç¹¼çºŒï¼ˆæœƒè·³éå·²æ”¶é›†çš„è³‡æ–™ï¼‰

### 4.3 é©—è­‰è³‡æ–™å®Œæ•´æ€§

åœ¨ Supabase Dashboard åŸ·è¡Œï¼š

```sql
-- æŸ¥çœ‹æ¯å€‹çƒå“¡çš„æ¯”è³½æ•¸é‡
SELECT
  player_name,
  COUNT(*) as games_count,
  MIN(game_date) as first_game,
  MAX(game_date) as last_game
FROM player_game_logs
GROUP BY player_key, player_name
ORDER BY games_count DESC
LIMIT 20;

-- æŸ¥çœ‹æ¯æ—¥æ¯”è³½æ•¸é‡ï¼ˆ2024-25 è³½å­£ï¼‰
SELECT
  game_date,
  COUNT(*) as games
FROM player_game_logs
WHERE game_date >= '2024-10-22' AND game_date < '2025-10-21'
GROUP BY game_date
ORDER BY game_date DESC;

-- æŸ¥çœ‹æ¯æ—¥æ¯”è³½æ•¸é‡ï¼ˆ2025-26 è³½å­£ï¼‰
SELECT
  game_date,
  COUNT(*) as games
FROM player_game_logs
WHERE game_date >= '2025-10-21'
GROUP BY game_date
ORDER BY game_date DESC;

-- æŸ¥çœ‹ç¸½è¨ˆ
SELECT
  COUNT(DISTINCT player_key) as total_players,
  COUNT(*) as total_games,
  MIN(game_date) as earliest_game,
  MAX(game_date) as latest_game
FROM player_game_logs;
```

---

## æ­¥é©Ÿ 5: å®Œæˆå¾Œçš„ä¸‹ä¸€æ­¥

è³‡æ–™æ”¶é›†å®Œæˆå¾Œï¼Œä½ å¯ä»¥ï¼š

### 5.1 å¯¦ä½œåˆ†æå¼•æ“

é–‹å§‹å»ºç«‹ï¼š
- ç†±é–€çƒå“¡åµæ¸¬
- çƒå“¡åƒ¹å€¼åˆ†æ
- è¶¨å‹¢åˆ†æ
- ä¸Šå ´æ™‚é–“åˆ†æ

### 5.2 è¨­å®šè‡ªå‹•åŒæ­¥ï¼ˆæœªä¾†ï¼‰

**é‡è¦**: Python å·¥å…·åªç”¨æ–¼ä¸€æ¬¡æ€§å»ºåˆ¶ï¼Œæœªä¾†æœƒä½¿ç”¨ï¼š

```typescript
// Next.js Cron Job (æ¯æ—¥è‡ªå‹•åŸ·è¡Œ)
// app/api/cron/daily-sync/route.ts

export async function GET() {
  // 1. å¾ NBA API ç²å–ä»Šå¤©çš„è³½ç¨‹
  const todayGames = await getNBASchedule(today);

  // 2. æ‰¾å‡ºæœ‰æ¯”è³½çš„çƒéšŠ
  const teams = extractTeamsFromGames(todayGames);

  // 3. æ‰¾å‡ºé€™äº›çƒéšŠçš„çƒå“¡
  const playersToUpdate = getPlayersFromTeams(teams);

  // 4. åªåŒæ­¥é€™äº›çƒå“¡ï¼ˆå¤§å¹…æ¸›å°‘ API èª¿ç”¨ï¼‰
  await batchSyncPlayers(playersToUpdate);

  return Response.json({ success: true });
}
```

è©³è¦‹ `docs/future-sync-strategy.md`

---

## å¸¸è¦‹å•é¡Œ

### Q: æ”¶é›†éç¨‹ä¸­å‡ºç¾éŒ¯èª¤æ€éº¼è¾¦ï¼Ÿ

A: è…³æœ¬æœƒè‡ªå‹•ï¼š
- è¨˜éŒ„éŒ¯èª¤ä½†ç¹¼çºŒåŸ·è¡Œ
- è·³éæ²’æœ‰æ¯”è³½çš„æ—¥æœŸ
- åœ¨çµæŸæ™‚é¡¯ç¤ºéŒ¯èª¤çµ±è¨ˆ

å°‘é‡éŒ¯èª¤æ˜¯æ­£å¸¸çš„ï¼ˆæŸäº›æ—¥æœŸå¯èƒ½æ²’æœ‰æ¯”è³½ï¼‰ã€‚

### Q: å¯ä»¥åŒæ™‚æ”¶é›†å¤šå€‹è³½å­£å—ï¼Ÿ

A: ä¸å»ºè­°ã€‚è«‹æŒ‰é †åºæ”¶é›†ï¼š
1. å…ˆå®Œæˆ 2024-25
2. å†æ”¶é›† 2025-26

é€™æ¨£å¯ä»¥é¿å… API rate limit å•é¡Œã€‚

### Q: å¦‚ä½•çŸ¥é“æ˜¯å¦æ”¶é›†å®Œæ•´ï¼Ÿ

A: åŸ·è¡Œé©—è­‰æŸ¥è©¢ï¼š
- æª¢æŸ¥çƒå“¡æ•¸é‡ï¼ˆæ‡‰è©²æ¥è¿‘è¯ç›Ÿç¸½æ•¸ï¼‰
- æª¢æŸ¥æ¯”è³½åˆ†å¸ƒï¼ˆæ¯å€‹æœ‰æ¯”è³½çš„æ—¥æœŸéƒ½æ‡‰æœ‰è¨˜éŒ„ï¼‰
- æª¢æŸ¥æ—¥æœŸç¯„åœï¼ˆæ‡‰è©²æ¶µè“‹æ•´å€‹è³½å­£ï¼‰

### Q: æ”¶é›†å¾Œé‚„éœ€è¦ Python å·¥å…·å—ï¼Ÿ

A: ä¸éœ€è¦ã€‚Python å·¥å…·åªç”¨æ–¼åˆå§‹åŒ–ã€‚å®Œæˆå¾Œï¼š
- Python å·¥å…·å¯ä»¥ä¿ç•™ï¼ˆç”¨æ–¼é‡å»ºï¼‰
- æ—¥å¸¸åŒæ­¥æœƒä½¿ç”¨ Next.js API
- æœªä¾†æœƒå¯¦ä½œ Cron Jobs è‡ªå‹•åŒæ­¥

---

## æ•ˆèƒ½æç¤º

### æé«˜æ”¶é›†é€Ÿåº¦ï¼ˆè¬¹æ…ä½¿ç”¨ï¼‰

å¦‚æœä½ çš„ç¶²è·¯ç©©å®šä¸” Yahoo API æ²’æœ‰é™åˆ¶ï¼Œå¯ä»¥ï¼š

1. æ¸›å°‘å»¶é²æ™‚é–“ï¼ˆç·¨è¼¯ `backfill_data.py`ï¼‰:
```python
# ç¬¬ 288 è¡Œ
time.sleep(0.2)  # å¾ 0.2 æ”¹ç‚º 0.1
```

2. åˆ†æ‰¹ä¸¦è¡ŒåŸ·è¡Œï¼ˆé€²éšï¼‰:
```bash
# çµ‚ç«¯ 1: è™•ç†å‰ 100 å€‹çƒå“¡
venv/bin/python backfill_data.py 12345 2024-25 100

# çµ‚ç«¯ 2: è™•ç†ç¬¬ 101-200 å€‹çƒå“¡ï¼ˆéœ€ä¿®æ”¹è…³æœ¬ï¼‰
```

**æ³¨æ„**: é€™å¯èƒ½è§¸ç™¼ API rate limitï¼Œè«‹è¬¹æ…ä½¿ç”¨ã€‚

---

## ç¸½çµ

**å®Œæ•´æµç¨‹**:

1. âœ… å–å¾— League ID (`/api/yahoo/leagues`)
2. âœ… æ¸¬è©¦ 5 å€‹çƒå“¡ (`2024-25`, `max_players=5`)
3. âœ… å›å¡« 2024-25 è³½å­£ï¼ˆæ‰€æœ‰çƒå“¡ï¼Œç´„ 3-4 å°æ™‚ï¼‰
4. âœ… æ”¶é›† 2025-26 è³½å­£ï¼ˆæ‰€æœ‰çƒå“¡ï¼Œç´„ 1-2 å°æ™‚ï¼‰
5. âœ… é©—è­‰è³‡æ–™å®Œæ•´æ€§ï¼ˆSQL æŸ¥è©¢ï¼‰
6. âœ… é–‹å§‹å¯¦ä½œåˆ†æå¼•æ“

**ä¸‹ä¸€æ­¥**: åƒè€ƒä¸»è¦å¯¦ä½œæ–‡æª”ç¹¼çºŒé–‹ç™¼åˆ†æåŠŸèƒ½ã€‚

é–‹å§‹æ”¶é›†å§ï¼ ğŸš€
